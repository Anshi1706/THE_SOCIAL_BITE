<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - The Social Bite</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    :root {
      --primary-color: #ff6b35;
      --secondary-color: #2c3e50;
      --success-color: #28a745;
      --danger-color: #dc3545;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .login-bg {
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                  url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80');
      background-size: cover;
      background-position: center;
      flex: 1;
    }
    
    .navbar-brand {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
    }
    
    .form-card {
      border-radius: 15px;
      border: none;
      max-width: 450px;
      width: 100%;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      margin: 2rem auto;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background-color: #e55a2b;
      border-color: #e55a2b;
      transform: translateY(-2px);
    }
    
    .input-group-text {
      background-color: #f8f9fa;
      border-right: none;
    }
    
    .form-control {
      border-left: none;
      padding-left: 0;
    }
    
    .form-control:focus {
      box-shadow: none;
      border-color: #ced4da;
    }
    
    .input-group:focus-within {
      box-shadow: 0 0 0 0.25rem rgba(255, 107, 53, 0.25);
      border-radius: 0.375rem;
    }
    
    .input-group:focus-within .input-group-text,
    .input-group:focus-within .form-control {
      border-color: var(--primary-color);
    }
    
    .text-primary {
      color: var(--primary-color) !important;
    }
    
    .custom-alert {
      position: fixed;
      top: 100px;
      right: 20px;
      z-index: 9999;
      min-width: 300px;
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .loading {
      position: relative;
      pointer-events: none;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 0.375rem;
    }
    
    .password-toggle {
      cursor: pointer;
      background: #f8f9fa;
      border: 1px solid #ced4da;
      border-left: none;
      display: flex;
      align-items: center;
      padding: 0 10px;
      border-radius: 0 0.375rem 0.375rem 0;
    }
    
    .password-toggle:hover {
      background: #e9ecef;
    }
    
    .demo-credentials {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }
    
    .demo-credentials .card-title {
      color: white;
    }
    
    .btn-loading {
      position: relative;
    }
    
    .btn-loading .btn-text {
      opacity: 0;
    }
    
    .btn-loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Mobile responsiveness */
    @media (max-width: 576px) {
      .form-card {
        margin: 1rem;
        padding: 1.5rem !important;
      }
      
      .custom-alert {
        right: 10px;
        left: 10px;
        min-width: auto;
      }
      
      .container {
        padding-left: 15px;
        padding-right: 15px;
      }
    }
  </style>
</head>
<body class="login-bg">
  <nav class="navbar navbar-expand-lg navbar-light shadow-sm sticky-top" style="background-color: white;">
    <div class="container">
      <a href="index.html" class="navbar-brand fw-bold" style="color:#ff6b35;">
        <i class="fas fa-utensils"></i> The Social Bite
      </a>
      <div class="navbar-nav ms-auto">
        <span class="nav-link"><i class="fas fa-map-marker-alt text-primary"></i> Kolkata</span>
        <a class="nav-link" href="register.html"><i class="fas fa-user-plus"></i> Sign Up</a>
      </div>
    </div>
  </nav>

  <div class="container d-flex justify-content-center align-items-center flex-grow-1">
    <div class="card shadow-lg p-4 form-card">
      <div class="text-center mb-4">
        <i class="fas fa-sign-in-alt fa-3x text-primary mb-3"></i>
        <h2 class="fw-bold text-primary">Welcome Back</h2>
        <p class="text-muted">Sign in to your account to continue</p>
      </div>
      
      <!-- Login Form -->
      <form id="loginForm">
        <div class="mb-3">
          <label for="role" class="form-label fw-semibold">Login as</label>
          <select id="role" name="role" class="form-select" required>
            <option value="customer">Customer</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        
        <div class="mb-3">
          <label for="email" class="form-label fw-semibold">Email Address</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
            <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" required />
          </div>
        </div>
        
        <div class="mb-3">
          <label for="password" class="form-label fw-semibold">Password</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required minlength="6" />
            <span class="password-toggle" id="passwordToggle">
              <i class="fas fa-eye"></i>
            </span>
          </div>
        </div>
        
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="rememberMe">
          <label class="form-check-label" for="rememberMe">Remember me</label>
        </div>
        
        <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold btn-loading">
          <span class="btn-text">
            <i class="fas fa-sign-in-alt me-2"></i>Login
          </span>
        </button>
        
        <div class="text-center mt-3">
          <a href="#" class="text-muted">Forgot your password?</a>
        </div>
        
        <p class="text-center mt-3 mb-0">
          Don't have an account? <a href="register.html" class="text-primary fw-semibold">Sign up here</a>
        </p>
      </form>
      
      <!-- Demo Credentials -->
      <div class="card mt-4 demo-credentials">
        <div class="card-body">
          <h6 class="card-title"><i class="fas fa-info-circle me-2"></i>Demo Credentials</h6>
          <div class="row">
            <div class="col-12 mb-2">
              <small><strong>Admin:</strong> admin@thesocialbite.com / admin123</small>
            </div>
            <div class="col-12">
              <small><strong>Customer:</strong> customer@example.com / customer123</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Password toggle functionality
    document.getElementById('passwordToggle').addEventListener('click', function() {
      const passwordInput = document.getElementById('password');
      const icon = this.querySelector('i');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    });
    
    // Enhanced login handler
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const role = document.getElementById('role').value;
      const rememberMe = document.getElementById('rememberMe').checked;
      
      const submitBtn = this.querySelector('button[type="submit"]');
      
      // Show loading state
      submitBtn.classList.add('btn-loading');
      submitBtn.disabled = true;
      
      // Basic validation
      if (!email || !password) {
        showNotification('Please fill in all fields', 'error');
        resetFormState();
        return;
      }
      
      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showNotification('Please enter a valid email address', 'error');
        resetFormState();
        return;
      }
      
      try {
        const result = await handleLogin(email, password, role);
        
        if (result.success) {
    showNotification('Login successful! Redirecting...', 'success');
    
    // Store remember me preference
    if (rememberMe) {
        localStorage.setItem('rememberMe', 'true');
        localStorage.setItem('rememberedEmail', email);
    } else {
        localStorage.removeItem('rememberMe');
        localStorage.removeItem('rememberedEmail');
    }
    
    // Wait a moment then redirect
    setTimeout(() => {
        window.location.href = 'index.html';
    }, 1500);
} else {
          showNotification(result.error || 'Login failed. Please try again.', 'error');
          resetFormState();
        }
      } catch (error) {
        console.error('Login error:', error);
        showNotification('An error occurred during login. Please try again.', 'error');
        resetFormState();
      }
      
      function resetFormState() {
        submitBtn.classList.remove('btn-loading');
        submitBtn.disabled = false;
      }
    });
    
    // Main login function that matches the main app's data structure
    async function handleLogin(email, password, role) {
      // Simulate API call delay
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      if (role === 'admin') {
        // Admin login
        if (email === 'admin@thesocialbite.com' && password === 'admin123') {
          const adminData = {
            id: Date.now(),
            name: 'Administrator',
            email: email,
            phone: '+91 98765 43210',
            restaurant: 'The Social Bite HQ',
            role: 'admin',
            joinDate: new Date().toISOString()
          };
          
          // Store in localStorage matching main app structure
          localStorage.setItem('adminUser', JSON.stringify(adminData));
          localStorage.setItem('currentUser', JSON.stringify(adminData));
          localStorage.setItem('isAdmin', 'true');
          localStorage.setItem('isLoggedIn', 'true');
          
          return { success: true };
        } else {
          return { 
            success: false, 
            error: 'Invalid admin credentials. Use: admin@thesocialbite.com / admin123' 
          };
        }
      } else {
        // Customer login
        // Check demo customer first
        if (email === 'customer@example.com' && password === 'customer123') {
          const customerData = {
            id: Date.now(),
            name: 'Demo Customer',
            email: email,
            password: password,
            phone: '+91 98765 43210',
            address: '123 Park Street, Kolkata',
            role: 'customer',
            joinDate: new Date().toISOString()
          };
          
          // Save to users array
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const existingUser = users.find(u => u.email === email);
          if (!existingUser) {
            users.push(customerData);
            localStorage.setItem('users', JSON.stringify(users));
          }
          
          // Set current user
          localStorage.setItem('currentUser', JSON.stringify(customerData));
          localStorage.setItem('isLoggedIn', 'true');
          localStorage.removeItem('adminUser');
          localStorage.removeItem('isAdmin');
          
          return { success: true };
        }
        
        // Check existing users
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const user = users.find(u => u.email === email && u.password === password);
        
        if (user) {
          // Remove password from stored session
          const { password: _, ...userWithoutPassword } = user;
          
          localStorage.setItem('currentUser', JSON.stringify(userWithoutPassword));
          localStorage.setItem('isLoggedIn', 'true');
          localStorage.removeItem('adminUser');
          localStorage.removeItem('isAdmin');
          
          return { success: true };
        } else {
          return { 
            success: false, 
            error: 'Invalid email or password. Please try again or register a new account.' 
          };
        }
      }
    }
    
    // Check for remembered email and redirect if already logged in
    document.addEventListener('DOMContentLoaded', function() {
      // Check if user is already logged in
      const isLoggedIn = localStorage.getItem('isLoggedIn');
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      
      if (isLoggedIn && currentUser) {
        // User is already logged in, redirect to main page
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 500);
        return;
      }
      
      // Set up remembered email
      const remembered = localStorage.getItem('rememberMe');
      const rememberedEmail = localStorage.getItem('rememberedEmail');
      
      if (remembered === 'true' && rememberedEmail) {
        document.getElementById('email').value = rememberedEmail;
        document.getElementById('rememberMe').checked = true;
      }
      
      // Auto-fill demo credentials for easier testing
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('demo') === 'admin') {
        document.getElementById('email').value = 'admin@thesocialbite.com';
        document.getElementById('password').value = 'admin123';
        document.getElementById('role').value = 'admin';
      } else if (urlParams.get('demo') === 'customer') {
        document.getElementById('email').value = 'customer@example.com';
        document.getElementById('password').value = 'customer123';
        document.getElementById('role').value = 'customer';
      }
      
      // Initialize demo data if needed
      initializeDemoData();
    });
    
    // Initialize demo users if they don't exist
    function initializeDemoData() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      // Add demo customer if not exists
      const demoCustomerExists = users.find(u => u.email === 'customer@example.com');
      if (!demoCustomerExists) {
        const demoCustomer = {
          id: Date.now(),
          name: 'Demo Customer',
          email: 'customer@example.com',
          password: 'customer123',
          phone: '+91 98765 43210',
          address: '123 Park Street, Kolkata',
          role: 'customer',
          joinDate: new Date().toISOString()
        };
        users.push(demoCustomer);
        localStorage.setItem('users', JSON.stringify(users));
      }
    }
    
    // Simple notification function
    function showNotification(message, type) {
      // Remove existing notifications
      const existingAlerts = document.querySelectorAll('.custom-alert');
      existingAlerts.forEach(alert => alert.remove());
      
      const alertDiv = document.createElement('div');
      alertDiv.className = `custom-alert alert alert-${type === 'error' ? 'danger' : 'success'} alert-dismissible fade show`;
      alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'} me-2"></i>
          <span class="flex-grow-1">${message}</span>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
      
      document.body.appendChild(alertDiv);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (alertDiv.parentElement) {
          alertDiv.remove();
        }
      }, 5000);
    }
  </script>
</body>
</html>